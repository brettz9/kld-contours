import{Polynomial as t,SqrtPolynomial as i}from"kld-polynomial";import{Point2D as e,Matrix2D as n,Vector2D as r}from"kld-affine";function s(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function h(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function o(t,i,e){return i&&h(t.prototype,i),e&&h(t,e),t}var a=function(){function t(i,e,n,r){s(this,t),this.x=i,this.y=e,this.width=n,this.height=r}return o(t,[{key:"overlaps",value:function(t){return this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.y+this.height>t.y}},{key:"isEmpty",value:function(){return 0!==this.width&&0!==this.height}},{key:"toString",value:function(){return"bbox("+this.x+","+this.y+","+this.width+","+this.height+")"}}]),t}(),p=function(){function t(i){s(this,t),this.points=void 0!==i?i:[]}return o(t,[{key:"getBoundingBox",value:function(){if(this.points.length>0){for(var t=this.points[0],i=this.points[0],e=1;e<this.points.length;e++){var n=this.points[e];t=t.min(n),i=i.max(n)}return new a(t.x,t.y,i.x-t.x,i.y-i.y)}return new a(0,0,0,0)}},{key:"toPolygon2D",value:function(){return this}},{key:"toString",value:function(){return this.points.map(function(t){return"".concat(t.x,", ").concat(t.y)}).join(" ")}}]),t}(),u=function(){function t(i,e){s(this,t),this.center=i,this.radius=e}return o(t,[{key:"getBoundingBox",value:function(){return new a(this.center.x-this.radius,this.center.y-this.radius,2*this.radius,2*this.radius)}},{key:"toPolygon2D",value:function(){return new p}}]),t}(),l=function(){function h(t,i,e,n){s(this,h),this.p1=t,this.p2=i,this.p3=e,this.p4=n}return o(h,[{key:"getPointAtParameter",value:function(t){var i=this.p1.lerp(this.p2,t),e=this.p2.lerp(this.p3,t),n=this.p3.lerp(this.p4,t),r=i.lerp(e,t),s=e.lerp(n,t);return r.lerp(s,t)}},{key:"splitAtParameter",value:function(t){var i=this.p1.lerp(this.p2,t),e=this.p2.lerp(this.p3,t),n=this.p3.lerp(this.p4,t),r=i.lerp(e,t),s=e.lerp(n,t),o=r.lerp(s,t);return[new h(this.p1,i,r,o),new h(o,s,n,this.p4)]}},{key:"getBernsteinPolynomials",value:function(){var i,e,n;i=this.p1.multiply(-1),e=this.p2.multiply(3),n=this.p3.multiply(-3);var r=i.add(e.add(n.add(this.p4)));i=this.p1.multiply(3),e=this.p2.multiply(-6),n=this.p3.multiply(3);var s=i.add(e.add(n));i=this.p1.multiply(-3),e=this.p2.multiply(3);var h=i.add(e),o=this.p1;return{x:new t(r.x,s.x,h.x,o.x),y:new t(r.y,s.y,h.y,o.y)}}},{key:"getArcLengthPolynomial",value:function(){if(!this.hasOwnProperty("arcLengthPolynomial")){var t,e,n;t=this.p1.multiply(-1),e=this.p2.multiply(3),n=this.p3.multiply(-3);var r=t.add(e.add(n.add(this.p4)));t=this.p1.multiply(3),e=this.p2.multiply(-6),n=this.p3.multiply(3);var s=t.add(e.add(n));t=this.p1.multiply(-3),e=this.p2.multiply(3);var h=t.add(e);this.arcLengthPolynomial=new i(9*(r.x*r.x+r.y*r.y),12*(s.x*r.x+s.y*r.y),4*(s.x*s.x+s.y*s.y)+6*(h.x*r.x+h.y*r.y),4*(h.x*s.x+h.y*s.y),h.x*h.x+h.y*h.y),this.arcLength=this.arcLengthPolynomial.romberg(0,1)}return this.arcLengthPolynomial}},{key:"getParameterFromArcLength",value:function(t){var i,e=this.getArcLengthPolynomial();if(t<=0)i=0;else if(t>=this.arcLength)i=1;else{i=t/this.arcLength;for(var n=0;n<=20;n++){var r=e.romberg(0,i)-t;if(Math.abs(r)<1e-9)break;var s=e.eval(i);if(0===s)break;i-=r/s}}return i}},{key:"getBoundingBox",value:function(){var t=this.getBernsteinPolynomials(),i=t.x.getDerivative(),n=t.y.getDerivative(),r=i.getRootsInInterval(0,1);r=r.concat(n.getRootsInInterval(0,1));var s=this.p1.min(this.p4),h=this.p1.max(this.p4);return r.forEach(function(i){if(0<=i&&i<=1){var n=new e(t.x.eval(i),t.y.eval(i));s=s.min(n),h=h.max(n)}}),new a(s.x,s.y,h.x-s.x,h.y-s.y)}},{key:"getAlignedBoundingBox",value:function(){return{bbox:this.getAlignedBezier().getBoundingBox(),transform:(new n).translation(this.p1.x,this.p1.y).rotateFromVector(r.fromPoints(this.p1,this.p4))}}},{key:"getAlignedBezier",value:function(){var t=n.translation(this.p1.x,this.p1.y).rotateFromVector(r.fromPoints(this.p1,this.p4)).inverse();return new h(this.p1.transform(t),this.p2.transform(t),this.p3.transform(t),this.p4.transform(t))}},{key:"toPolygon2D",value:function(t){var i=[],n=new r(0,0);return t=void 0!==t?t:1,i.push(this.p1),function s(h,o,a,p){var u=h.lerp(o,.5),l=o.lerp(a,.5),y=a.lerp(p,.5),c=u.lerp(l,.5),f=l.lerp(y,.5),v=c.lerp(f,.5),g=r.fromPoints(h,p),x=r.fromPoints(h,o),m=r.fromPoints(p,a),d=0;!1===n.equals(x)&&(d=g.perpendicular(x).length());if(!1===n.equals(m)){var w=g.perpendicular(m);d=Math.max(d,w.length())}d>t?(s(h,u,c,v),i.push(new e(v.x,v.y)),s(v,f,y,p)):i.push(new e(v.x,v.y))}(this.p1,this.p2,this.p3,this.p4),i.push(this.p4),new p(i)}},{key:"toString",value:function(){return"M"+this.p1.x+","+this.p1.y+" C"+this.p2.x+","+this.p2.y+" "+this.p3.x+","+this.p3.y+" "+this.p4.x+","+this.p4.y}}]),h}(),y=function(){function t(i,e,n){s(this,t),this.center=i,this.radiusX=e,this.radiusY=n}return o(t,[{key:"getBoundingBox",value:function(){return new a(this.center.x-this.radiusX,this.center.y-this.radiusY,2*this.radiusX,2*this.radiusY)}},{key:"toPolygon2D",value:function(){return new p}}]),t}(),c=function(){function t(i,e){s(this,t),this.p1=i,this.p2=e}return o(t,[{key:"getBoundingBox",value:function(){var t=this.p1.min(this.p2),i=this.p1.max(this.p2);return new a(t.x,t.y,i.x-t.x,i.y-t.y)}},{key:"toPolygon2D",value:function(){return new p([this.p1,this.p2])}}]),t}(),f=function(){function h(t,i,e){s(this,h),this.p1=t,this.p2=i,this.p3=e}return o(h,[{key:"getPointAtParameter",value:function(t){var i=this.p1.lerp(this.p2,t),e=this.p2.lerp(this.p3,t);return i.lerp(e,t)}},{key:"splitAtParameter",value:function(t){var i=this.p1.lerp(this.p2,t),e=this.p2.lerp(this.p3,t),n=i.lerp(e,t);return[new h(this.p1,i,n),new h(n,e,this.p3)]}},{key:"getBernsteinPolynomials",value:function(){var i;i=this.p2.multiply(-2);var e=this.p1.add(i.add(this.p3));i=this.p1.multiply(-2);var n=this.p2.multiply(2),r=i.add(n),s=this.p1;return{x:new t(e.x,r.x,s.x),y:new t(e.y,r.y,s.y)}}},{key:"getArcLengthPolynomial",value:function(){if(!this.hasOwnProperty("arcLengthPolynomial")){var t;t=this.p2.multiply(-2);var e=this.p1.add(t.add(this.p3));t=this.p1.multiply(-2);var n=this.p2.multiply(2),r=t.add(n);this.arcLengthPolynomial=new i(4*(e.x*e.x+e.y*e.y),4*(r.x*e.x+r.y*e.y),r.x*r.x+r.y*r.y),this.arcLength=this.arcLengthPolynomial.simpson(0,1)}return this.arcLengthPolynomial}},{key:"getParameterFromArcLength",value:function(t){var i,e=this.getArcLengthPolynomial();if(t<=0)i=0;else if(t>=this.arcLength)i=1;else{i=t/this.arcLength;for(var n=0;n<=20;n++){var r=e.romberg(0,i)-t;if(Math.abs(r)<1e-9)break;var s=e.eval(i);if(0===s)break;i-=r/s}}return i}},{key:"getBoundingBox",value:function(){var t=this.getBernsteinPolynomials(),i=t.x.getDerivative(),n=t.y.getDerivative(),r=i.getRootsInInterval(0,1);r=r.concat(n.getRootsInInterval(0,1));var s=this.p1.min(this.p3),h=this.p1.max(this.p3);return r.forEach(function(i){if(0<=i&&i<=1){var n=new e(t.x.eval(i),t.y.eval(i));s=s.min(n),h=h.max(n)}}),new a(s.x,s.y,h.x-s.x,h.y-s.y)}},{key:"getAlignedBoundingBox",value:function(){return{bbox:this.getAlignedBezier().getBoundingBox(),transform:n.translation(this.p1.x,this.p1.y).rotateFromVector(r.fromPoints(this.p1,this.p3))}}},{key:"getAlignedBezier",value:function(){var t=n.translation(this.p1.x,this.p1.y).rotateFromVector(r.fromPoints(this.p1,this.p3)).inverse();return new h(this.p1.transform(t),this.p2.transform(t),this.p3.transform(t))}},{key:"toPolygon2D",value:function(t){var i=[],n=new r(0,0);return t=void 0!==t?t:1,i.push(this.p1),function s(h,o,a){var p=h.lerp(o,.5),u=o.lerp(a,.5),l=p.lerp(u,.5),y=r.fromPoints(h,a),c=r.fromPoints(h,o),f=0;!1===n.equals(c)&&(f=y.perpendicular(c).length());f>t?(s(h,p,l),i.push(new e(l.x,l.y)),s(l,u,a)):i.push(new e(l.x,l.y))}(this.p1,this.p2,this.p3),i.push(this.p3),new p(i)}},{key:"toString",value:function(){return"M"+this.p1.x+","+this.p1.y+" Q"+this.p2.x+","+this.p2.y+" "+this.p3.x+","+this.p3.y}}]),h}(),v=function(){function t(i,e,n,r){s(this,t),this.x=i,this.y=e,this.width=n,this.height=r}return o(t,[{key:"getBoundingBox",value:function(){return new a(this.x,this.y,this.width,this.height)}},{key:"toPolygon2D",value:function(){return new p([new e(this.x,this.y),new e(this.x+this.width,this.y),new e(this.x+this.width,this.y+this.height),new e(this.x,this.y+this.height)])}}]),t}();export{a as BoundingBox2D,u as Circle2D,l as CubicBezier2D,y as Ellipse2D,c as Line2D,p as Polygon2D,f as QuadraticBezier2D,v as Rectangle2D};
//# sourceMappingURL=index-esm.min.js.map
