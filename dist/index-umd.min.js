!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports,require("kld-polynomial"),require("kld-affine")):"function"==typeof define&&define.amd?define(["exports","kld-polynomial","kld-affine"],i):i((t=t||self).KldContours={},t.kldPolynomial,t.kldAffine)}(this,function(t,i,e){"use strict";function n(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function r(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function s(t,i,e){return i&&r(t.prototype,i),e&&r(t,e),t}var o=function(){function t(i,e,r,s){n(this,t),this.x=i,this.y=e,this.width=r,this.height=s}return s(t,[{key:"overlaps",value:function(t){return this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.y+this.height>t.y}},{key:"isEmpty",value:function(){return 0!==this.width&&0!==this.height}},{key:"toString",value:function(){return"bbox("+this.x+","+this.y+","+this.width+","+this.height+")"}}]),t}(),h=function(){function t(i){n(this,t),this.points=void 0!==i?i:[]}return s(t,[{key:"getBoundingBox",value:function(){if(this.points.length>0){for(var t=this.points[0],i=this.points[0],e=1;e<this.points.length;e++){var n=this.points[e];t=t.min(n),i=i.max(n)}return new o(t.x,t.y,i.x-t.x,i.y-i.y)}return new o(0,0,0,0)}},{key:"toPolygon2D",value:function(){return this}},{key:"toString",value:function(){return this.points.map(function(t){return"".concat(t.x,", ").concat(t.y)}).join(" ")}}]),t}(),a=function(){function t(i,e){n(this,t),this.center=i,this.radius=e}return s(t,[{key:"getBoundingBox",value:function(){return new o(this.center.x-this.radius,this.center.y-this.radius,2*this.radius,2*this.radius)}},{key:"toPolygon2D",value:function(){return new h}}]),t}(),l=function(){function t(i,e,r,s){n(this,t),this.p1=i,this.p2=e,this.p3=r,this.p4=s}return s(t,[{key:"getPointAtParameter",value:function(t){var i=this.p1.lerp(this.p2,t),e=this.p2.lerp(this.p3,t),n=this.p3.lerp(this.p4,t),r=i.lerp(e,t),s=e.lerp(n,t);return r.lerp(s,t)}},{key:"splitAtParameter",value:function(i){var e=this.p1.lerp(this.p2,i),n=this.p2.lerp(this.p3,i),r=this.p3.lerp(this.p4,i),s=e.lerp(n,i),o=n.lerp(r,i),h=s.lerp(o,i);return[new t(this.p1,e,s,h),new t(h,o,r,this.p4)]}},{key:"getBernsteinPolynomials",value:function(){var t,e,n;t=this.p1.multiply(-1),e=this.p2.multiply(3),n=this.p3.multiply(-3);var r=t.add(e.add(n.add(this.p4)));t=this.p1.multiply(3),e=this.p2.multiply(-6),n=this.p3.multiply(3);var s=t.add(e.add(n));t=this.p1.multiply(-3),e=this.p2.multiply(3);var o=t.add(e),h=this.p1;return{x:new i.Polynomial(r.x,s.x,o.x,h.x),y:new i.Polynomial(r.y,s.y,o.y,h.y)}}},{key:"getArcLengthPolynomial",value:function(){if(!this.hasOwnProperty("arcLengthPolynomial")){var t,e,n;t=this.p1.multiply(-1),e=this.p2.multiply(3),n=this.p3.multiply(-3);var r=t.add(e.add(n.add(this.p4)));t=this.p1.multiply(3),e=this.p2.multiply(-6),n=this.p3.multiply(3);var s=t.add(e.add(n));t=this.p1.multiply(-3),e=this.p2.multiply(3);var o=t.add(e);this.arcLengthPolynomial=new i.SqrtPolynomial(9*(r.x*r.x+r.y*r.y),12*(s.x*r.x+s.y*r.y),4*(s.x*s.x+s.y*s.y)+6*(o.x*r.x+o.y*r.y),4*(o.x*s.x+o.y*s.y),o.x*o.x+o.y*o.y),this.arcLength=this.arcLengthPolynomial.romberg(0,1)}return this.arcLengthPolynomial}},{key:"getParameterFromArcLength",value:function(t){var i,e=this.getArcLengthPolynomial();if(t<=0)i=0;else if(t>=this.arcLength)i=1;else{i=t/this.arcLength;for(var n=0;n<=20;n++){var r=e.romberg(0,i)-t;if(Math.abs(r)<1e-9)break;var s=e.eval(i);if(0===s)break;i-=r/s}}return i}},{key:"getBoundingBox",value:function(){var t=this.getBernsteinPolynomials(),i=t.x.getDerivative(),n=t.y.getDerivative(),r=i.getRootsInInterval(0,1);r=r.concat(n.getRootsInInterval(0,1));var s=this.p1.min(this.p4),h=this.p1.max(this.p4);return r.forEach(function(i){if(0<=i&&i<=1){var n=new e.Point2D(t.x.eval(i),t.y.eval(i));s=s.min(n),h=h.max(n)}}),new o(s.x,s.y,h.x-s.x,h.y-s.y)}},{key:"getAlignedBoundingBox",value:function(){return{bbox:this.getAlignedBezier().getBoundingBox(),transform:(new e.Matrix2D).translation(this.p1.x,this.p1.y).rotateFromVector(e.Vector2D.fromPoints(this.p1,this.p4))}}},{key:"getAlignedBezier",value:function(){var i=e.Matrix2D.translation(this.p1.x,this.p1.y).rotateFromVector(e.Vector2D.fromPoints(this.p1,this.p4)).inverse();return new t(this.p1.transform(i),this.p2.transform(i),this.p3.transform(i),this.p4.transform(i))}},{key:"toPolygon2D",value:function(t){var i=[],n=new e.Vector2D(0,0);return t=void 0!==t?t:1,i.push(this.p1),function r(s,o,h,a){var l=s.lerp(o,.5),p=o.lerp(h,.5),u=h.lerp(a,.5),y=l.lerp(p,.5),c=p.lerp(u,.5),f=y.lerp(c,.5),g=e.Vector2D.fromPoints(s,a),v=e.Vector2D.fromPoints(s,o),x=e.Vector2D.fromPoints(a,h),m=0;!1===n.equals(v)&&(m=g.perpendicular(v).length());if(!1===n.equals(x)){var d=g.perpendicular(x);m=Math.max(m,d.length())}m>t?(r(s,l,y,f),i.push(new e.Point2D(f.x,f.y)),r(f,c,u,a)):i.push(new e.Point2D(f.x,f.y))}(this.p1,this.p2,this.p3,this.p4),i.push(this.p4),new h(i)}},{key:"toString",value:function(){return"M"+this.p1.x+","+this.p1.y+" C"+this.p2.x+","+this.p2.y+" "+this.p3.x+","+this.p3.y+" "+this.p4.x+","+this.p4.y}}]),t}(),p=function(){function t(i,e,r){n(this,t),this.center=i,this.radiusX=e,this.radiusY=r}return s(t,[{key:"getBoundingBox",value:function(){return new o(this.center.x-this.radiusX,this.center.y-this.radiusY,2*this.radiusX,2*this.radiusY)}},{key:"toPolygon2D",value:function(){return new h}}]),t}(),u=function(){function t(i,e){n(this,t),this.p1=i,this.p2=e}return s(t,[{key:"getBoundingBox",value:function(){var t=this.p1.min(this.p2),i=this.p1.max(this.p2);return new o(t.x,t.y,i.x-t.x,i.y-t.y)}},{key:"toPolygon2D",value:function(){return new h([this.p1,this.p2])}}]),t}(),y=function(){function t(i,e,r){n(this,t),this.p1=i,this.p2=e,this.p3=r}return s(t,[{key:"getPointAtParameter",value:function(t){var i=this.p1.lerp(this.p2,t),e=this.p2.lerp(this.p3,t);return i.lerp(e,t)}},{key:"splitAtParameter",value:function(i){var e=this.p1.lerp(this.p2,i),n=this.p2.lerp(this.p3,i),r=e.lerp(n,i);return[new t(this.p1,e,r),new t(r,n,this.p3)]}},{key:"getBernsteinPolynomials",value:function(){var t;t=this.p2.multiply(-2);var e=this.p1.add(t.add(this.p3));t=this.p1.multiply(-2);var n=this.p2.multiply(2),r=t.add(n),s=this.p1;return{x:new i.Polynomial(e.x,r.x,s.x),y:new i.Polynomial(e.y,r.y,s.y)}}},{key:"getArcLengthPolynomial",value:function(){if(!this.hasOwnProperty("arcLengthPolynomial")){var t;t=this.p2.multiply(-2);var e=this.p1.add(t.add(this.p3));t=this.p1.multiply(-2);var n=this.p2.multiply(2),r=t.add(n);this.arcLengthPolynomial=new i.SqrtPolynomial(4*(e.x*e.x+e.y*e.y),4*(r.x*e.x+r.y*e.y),r.x*r.x+r.y*r.y),this.arcLength=this.arcLengthPolynomial.simpson(0,1)}return this.arcLengthPolynomial}},{key:"getParameterFromArcLength",value:function(t){var i,e=this.getArcLengthPolynomial();if(t<=0)i=0;else if(t>=this.arcLength)i=1;else{i=t/this.arcLength;for(var n=0;n<=20;n++){var r=e.romberg(0,i)-t;if(Math.abs(r)<1e-9)break;var s=e.eval(i);if(0===s)break;i-=r/s}}return i}},{key:"getBoundingBox",value:function(){var t=this.getBernsteinPolynomials(),i=t.x.getDerivative(),n=t.y.getDerivative(),r=i.getRootsInInterval(0,1);r=r.concat(n.getRootsInInterval(0,1));var s=this.p1.min(this.p3),h=this.p1.max(this.p3);return r.forEach(function(i){if(0<=i&&i<=1){var n=new e.Point2D(t.x.eval(i),t.y.eval(i));s=s.min(n),h=h.max(n)}}),new o(s.x,s.y,h.x-s.x,h.y-s.y)}},{key:"getAlignedBoundingBox",value:function(){return{bbox:this.getAlignedBezier().getBoundingBox(),transform:e.Matrix2D.translation(this.p1.x,this.p1.y).rotateFromVector(e.Vector2D.fromPoints(this.p1,this.p3))}}},{key:"getAlignedBezier",value:function(){var i=e.Matrix2D.translation(this.p1.x,this.p1.y).rotateFromVector(e.Vector2D.fromPoints(this.p1,this.p3)).inverse();return new t(this.p1.transform(i),this.p2.transform(i),this.p3.transform(i))}},{key:"toPolygon2D",value:function(t){var i=[],n=new e.Vector2D(0,0);return t=void 0!==t?t:1,i.push(this.p1),function r(s,o,h){var a=s.lerp(o,.5),l=o.lerp(h,.5),p=a.lerp(l,.5),u=e.Vector2D.fromPoints(s,h),y=e.Vector2D.fromPoints(s,o),c=0;!1===n.equals(y)&&(c=u.perpendicular(y).length());c>t?(r(s,a,p),i.push(new e.Point2D(p.x,p.y)),r(p,l,h)):i.push(new e.Point2D(p.x,p.y))}(this.p1,this.p2,this.p3),i.push(this.p3),new h(i)}},{key:"toString",value:function(){return"M"+this.p1.x+","+this.p1.y+" Q"+this.p2.x+","+this.p2.y+" "+this.p3.x+","+this.p3.y}}]),t}(),c=function(){function t(i,e,r,s){n(this,t),this.x=i,this.y=e,this.width=r,this.height=s}return s(t,[{key:"getBoundingBox",value:function(){return new o(this.x,this.y,this.width,this.height)}},{key:"toPolygon2D",value:function(){return new h([new e.Point2D(this.x,this.y),new e.Point2D(this.x+this.width,this.y),new e.Point2D(this.x+this.width,this.y+this.height),new e.Point2D(this.x,this.y+this.height)])}}]),t}();t.BoundingBox2D=o,t.Circle2D=a,t.CubicBezier2D=l,t.Ellipse2D=p,t.Line2D=u,t.Polygon2D=h,t.QuadraticBezier2D=y,t.Rectangle2D=c,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=index-umd.min.js.map
